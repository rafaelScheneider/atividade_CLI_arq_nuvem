---
- name: Run data cleaner on EC2
  hosts: ec2
  become: true

  vars:
    s3_bucket_name: "my-data-lake-bucket-example"

  tasks:
    - name: Ensure Python 3 and pip are installed
      ansible.builtin.yum:
        name:
          - python3
          - python3-pip
        state: present

    - name: Install Python packages using pip
      ansible.builtin.pip:
        name:
          - wfdb
          - pandas
        executable: pip3

    - name: Run the Python data cleaner
      command: python3 /home/ec2-user/data_cleaner.py {{ s3_bucket_name }}
